<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SIUUUU! ULTIMATE ARCHIVE</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --main: #eab308; --bg: #fdfbf7; --heart: #ff4d6d; --accent: #10b981; --slate: #64748b; }
        body { background: var(--bg); font-family: 'Pretendard', sans-serif; margin: 0; padding-bottom: 80px; color: #334155; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }

        /* [1] í”„ë¦¬ë¯¸ì—„ ë¡œê·¸ì¸ UI */
        #loginOverlay { position: fixed; inset: 0; background: #fff; z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; transition: 0.5s; }
        .login-box { width: 100%; max-width: 400px; text-align: center; }
        .login-box h1 { font-size: 3.5rem; color: var(--main); margin: 0; font-weight: 900; letter-spacing: -3px; }
        .user-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 30px 0; }
        .user-card { background: #f8fafc; border: 2px solid #f1f5f9; border-radius: 20px; padding: 18px 10px; font-weight: 800; cursor: pointer; transition: 0.3s; }
        .user-card.active { border-color: var(--main); background: #fefce8; transform: translateY(-3px); box-shadow: 0 10px 20px rgba(234,179,8,0.15); }
        #authForm { opacity: 0; transform: translateY(10px); transition: 0.4s; pointer-events: none; }
        #authForm.show { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .pw-input { width: 100%; padding: 16px; border-radius: 15px; border: 2px solid #e2e8f0; font-size: 1rem; font-weight: 700; text-align: center; margin-bottom: 12px; outline: none; box-sizing: border-box; }
        .login-btn { width: 100%; padding: 16px; background: var(--main); color: white; border: none; border-radius: 15px; font-weight: 900; font-size: 1.1rem; cursor: pointer; }

        /* [2] ìº˜ë¦°ë” & ë©”ì¸ ì¹´ë“œ */
        .card { background: #fff; margin: 15px; border-radius: 25px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.04); position: relative; }
        #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-top: 15px; }
        .cal-day { background: #f8fafc; border-radius: 12px; padding: 8px 0; font-size: 11px; text-align: center; min-height: 50px; cursor: pointer; transition: 0.2s; position: relative; }
        .cal-day:active { background: #f1f5f9; }
        .dday-tag { font-size: 8px; color: white; background: var(--heart); border-radius: 4px; padding: 1px 3px; display: block; margin: 2px 2px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* [3] ì¸ìŠ¤íƒ€ SNS ìŠ¤íƒ€ì¼ */
        .btn-tab { padding: 10px 20px; border-radius: 50px; background: #fff; border: 1.5px solid #eee; font-weight: 800; cursor: pointer; white-space: nowrap; transition: 0.2s; }
        .btn-tab.active { background: var(--main); color: #fff; border-color: var(--main); }
        .double-heart { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); color: white; font-size: 80px; z-index: 10; pointer-events: none; transition: 0.4s; opacity: 0; text-shadow: 0 0 20px rgba(0,0,0,0.3); }
        .double-heart.active { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
        .comment-sec { padding: 15px 20px; background: #fafafa; border-top: 1px solid #f0f0f0; font-size: 13px; }
        textarea { width: 100%; border: none; background: #f1f5f9; border-radius: 15px; padding: 15px; box-sizing: border-box; resize: none; font-size: 14px; margin-bottom: 10px; outline: none; }

        /* [4] ëª¨ë‹¬ */
        #editModal, #dateModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 5000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-box { width: 85%; background: white; padding: 25px; border-radius: 25px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <h1>SIUUUU!</h1>
        <p style="color:var(--slate)">ìš°ë¦¬ë“¤ë§Œì˜ ë¹„ë°€ ì•„ì¹´ì´ë¸Œ</p>
        <div id="loginList" class="user-grid"></div>
        <div id="authForm">
            <input type="text" id="pwInp" class="pw-input">
            <button class="login-btn" onclick="verifyLogin()">ìŠ¤ì¿¼ë“œ ì…ì¥</button>
        </div>
    </div>
</div>

<div class="card" style="padding:20px;">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <b id="calTitle" style="font-size:1.2rem; letter-spacing:-0.5px;">ğŸ“… 2026.03</b>
        <span id="monthCount" style="background:var(--main); color:white; padding:3px 12px; border-radius:20px; font-size:12px; font-weight:800;">ê¸°ë¡ 0ê°œ</span>
    </div>
    <div id="calendar"></div>
</div>

<div class="header" style="position: sticky; top: 0; z-index: 1000; background: rgba(253, 251, 247, 0.95); backdrop-filter: blur(10px); padding: 12px 0;">
    <div id="tabBar" style="display: flex; overflow-x: auto; gap: 8px; padding: 0 15px; scrollbar-width: none;">
        <button class="btn-tab active" onclick="filterFeed('all', this)">#ì „ì²´ë³´ê¸°</button>
        <button class="btn-tab" onclick="filterFeed('ì¶”ì–µ', this)">#ì¶”ì–µğŸ§¸</button>
        <button class="btn-tab" onclick="filterFeed('ìƒì¼', this)">#ìƒì¼ğŸ‚</button>
        <button class="btn-tab" onclick="filterFeed('ì„±ê³µ', this)">#ì„±ê³µğŸ”¥</button>
    </div>
</div>

<div class="card" style="padding: 20px;">
    <div style="display:flex; justify-content:space-between; margin-bottom:12px; align-items:center;">
        <b id="myIdDisplay" style="color:var(--main); font-size:1.1rem;">ì ‘ì† ì¤‘...</b>
        <small onclick="location.reload()" style="color:var(--slate); cursor:pointer; font-weight:700;">ë¡œê·¸ì•„ì›ƒ</small>
    </div>
    <textarea id="pText" rows="3" placeholder="ì˜¤ëŠ˜ ì–´ë–¤ ì¼ì´ ìˆì—ˆë‚˜ìš”?"></textarea>
    <input type="file" id="fInp" multiple style="display: none;" onchange="updateFileLabel(this)">
    <label for="fInp" id="fLab" style="display: block; padding: 15px; background: #f8fafc; border: 2px dashed #e2e8f0; border-radius: 15px; text-align: center; font-size: 13px; font-weight: 800; margin-bottom: 12px; cursor: pointer; color: var(--slate);">ğŸ“¸ ì‚¬ì§„ ì„ íƒ (ì—¬ëŸ¬ ì¥ ê°€ëŠ¥)</label>
    <div style="display: flex; gap: 10px;">
        <button onclick="upPost()" id="upBtn" style="flex: 2; background: var(--main); color: white; border: none; padding: 16px; border-radius: 18px; font-weight: 900; font-size: 1rem; box-shadow: 0 4px 12px rgba(234,179,8,0.2);">ê¸°ì–µ ì €ì¥</button>
        <button onclick="runLucky()" style="flex: 1; background: var(--accent); color: white; border: none; padding: 16px; border-radius: 18px; font-weight: 900; font-size: 1rem; box-shadow: 0 4px 12px rgba(16,185,129,0.2);">ìš´ì„¸</button>
    </div>
</div>

<div id="feedArea"></div>

<div id="editModal"><div class="modal-box"><h3>ê²Œì‹œë¬¼ ìˆ˜ì •</h3><textarea id="editArea" rows="5"></textarea>
    <div style="display:flex; gap:10px;"><button onclick="saveEdit()" style="flex:1; background:var(--main); color:white; border:none; padding:15px; border-radius:15px; font-weight:800;">ìˆ˜ì • ì™„ë£Œ</button><button onclick="deletePost()" style="flex:1; background:#ef4444; color:white; border:none; border-radius:15px; font-weight:800;">ì‚­ì œ</button><button onclick="closeModal()" style="flex:1; background:#eee; border:none; border-radius:15px; font-weight:800;">ì·¨ì†Œ</button></div></div></div>

<div id="dateModal"><div class="modal-box"><h3>ğŸ—“ï¸ <span id="selDateText"></span> ì¼ì •/ë””ë°ì´</h3><div id="existingDates" style="margin-bottom:15px;"></div><hr style="border:0; border-top:1px solid #eee; margin-bottom:15px;">
    <input type="text" id="dateTitle" placeholder="ì¼ì • ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" style="width:100%; padding:15px; margin-bottom:15px; border-radius:15px; border:1px solid #ddd; box-sizing:border-box; font-size:1rem;">
    <div style="display:flex; gap:10px;"><button onclick="saveSch()" style="flex:1; background:var(--main); color:white; border:none; padding:15px; border-radius:15px; font-weight:800;">ì¼ì • ì¶”ê°€</button><button onclick="closeModal()" style="flex:1; background:#eee; border:none; border-radius:15px; font-weight:800;">ë‹«ê¸°</button></div></div></div>

<script>
    const SB_URL = "YOUR_URL";
    const SB_KEY = "YOUR_KEY";
    const client = supabase.createClient(SB_URL, SB_KEY);
    const SQUAD = ["íƒœì§€ì•„", "ì¡°ì„±ìš°", "ì—¼íƒœì„±", "ê¹€íƒœí˜„", "ì´ì¤€ì„œ", "ì´ì§€í˜¸", "ì´ë‹¤ì›"];
    const MEMBER_KEYS = { "íƒœì§€ì•„":"íƒœì§€ì•„", "ì¡°ì„±ìš°":"ì¡°ì„±ìš°", "ì—¼íƒœì„±":"ì—¼íƒœì„±", "ê¹€íƒœí˜„":"ê¹€íƒœí˜„", "ì´ì¤€ì„œ":"ì´ì¤€ì„œ", "ì´ì§€í˜¸":"ì´ì§€í˜¸", "ì´ë‹¤ì›":"ì´ë‹¤ì›" };

    let rawPosts = [], rawSchedules = [], myId = "", selectedTempUser = "", currentEditId = null, selectedDate = "";

    window.onload = () => {
        const list = document.getElementById("loginList");
        SQUAD.forEach(n => {
            const d = document.createElement("div"); d.className = "user-card"; d.innerText = n;
            d.onclick = () => {
                selectedTempUser = n;
                document.querySelectorAll('.user-card').forEach(x => x.classList.remove('active'));
                d.classList.add('active');
                const form = document.getElementById("authForm"); form.classList.add("show");
                const inp = document.getElementById("pwInp"); inp.placeholder = `${n}ë‹˜ì˜ ì½”ë“œ ì…ë ¥`; inp.focus();
            };
            list.appendChild(d);
        });
    };

    function verifyLogin() {
        const val = document.getElementById("pwInp").value.trim();
        if(val === MEMBER_KEYS[selectedTempUser]) {
            myId = selectedTempUser;
            document.getElementById("loginOverlay").style.opacity = "0";
            setTimeout(() => {
                document.getElementById("loginOverlay").style.display = "none";
                document.getElementById("myIdDisplay").innerText = `ğŸ‘¤ ${myId}ë‹˜`;
                loadData();
            }, 500);
        } else { alert("ì½”ë“œê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!"); }
    }

    async function loadData() {
        const { data: p } = await client.from("posts").select("*, comments(*)").order("created_at", { ascending: false });
        const { data: s } = await client.from("schedules").select("*");
        rawPosts = p || []; rawSchedules = s || [];
        renderPosts(rawPosts); renderCalendar();
    }

    async function upPost() {
        const t = document.getElementById("pText").value;
        const f = document.getElementById("fInp").files;
        if(!t) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        const btn = document.getElementById("upBtn"); btn.innerText = "ì—…ë¡œë“œ ì¤‘..."; btn.disabled = true;
        try {
            let urls = [];
            for(let file of f) {
                const path = `arc/${Date.now()}_${file.name}`;
                await client.storage.from("photos").upload(path, file);
                urls.push(client.storage.from("photos").getPublicUrl(path).data.publicUrl);
            }
            await client.from("posts").insert([{ user_name: myId, content: t, image_url: urls.join(",") }]);
            location.reload();
        } catch (e) { alert("ì˜¤ë¥˜: " + e.message); btn.disabled = false; btn.innerText = "ê¸°ì–µ ì €ì¥"; }
    }

    function renderCalendar() {
        const cal = document.getElementById("calendar"); cal.innerHTML = "";
        const now = new Date(); const y = now.getFullYear(), m = now.getMonth();
        document.getElementById("calTitle").innerText = `ğŸ“… ${y}.${String(m+1).padStart(2,'0')}`;
        const first = new Date(y, m, 1).getDay(), last = new Date(y, m+1, 0).getDate();
        const postsMonth = rawPosts.filter(p => new Date(p.created_at).getMonth() === m);
        document.getElementById("monthCount").innerText = `ê¸°ë¡ ${postsMonth.length}ê°œ`;
        for(let i=0; i<first; i++) cal.innerHTML += "<div></div>";
        for(let d=1; d<=last; d++) {
            const dStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const count = postsMonth.filter(p => new Date(p.created_at).getDate() === d).length;
            const schs = rawSchedules.filter(s => s.target_date === dStr);
            cal.innerHTML += `<div class="cal-day" onclick="openDateModal('${dStr}')">
                <b>${d}</b>${count>0?`<div style="color:var(--main); font-weight:900; font-size:9px;">â—${count}</div>`:''}
                ${schs.map(s=>`<span class="dday-tag">${s.title}</span>`).join('')}</div>`;
        }
    }

    function openDateModal(date) {
        selectedDate = date; document.getElementById("selDateText").innerText = date;
        document.getElementById("dateModal").style.display = "flex";
        const mine = rawSchedules.filter(s => s.target_date === date);
        document.getElementById("existingDates").innerHTML = mine.map(s => `<div style="padding:10px; background:#f8fafc; border-radius:10px; margin-bottom:5px; display:flex; justify-content:space-between;">${s.title} <span onclick="delSch('${s.id}')" style="color:red; cursor:pointer;">ì‚­ì œ</span></div>`).join('');
    }

    async function saveSch() {
        const t = document.getElementById("dateTitle").value; if(!t) return;
        await client.from("schedules").insert([{ title: t, target_date: selectedDate, user_name: myId }]);
        location.reload();
    }
    async function delSch(id) { if(confirm("ì‚­ì œí• ê¹Œìš”?")) { await client.from("schedules").delete().eq("id", id); location.reload(); } }

    function renderPosts(items) {
        const area = document.getElementById("feedArea");
        area.innerHTML = items.map(p => {
            const urls = p.image_url ? p.image_url.split(",") : [];
            const isLiked = p.liked_users?.includes(myId);
            return `<div class="card">
                <div style="padding:15px; display:flex; justify-content:space-between; align-items:center;">
                    <b style="color:var(--main); font-size:1.05rem;">@${p.user_name}</b>
                    ${p.user_name === myId ? `<span onclick="openEdit('${p.id}', \`${p.content}\`)" style="opacity:0.3; font-size:12px; cursor:pointer;">ìˆ˜ì •/ì‚­ì œ</span>` : ''}
                </div>
                <div class="swiper" ondblclick="handleDouble('${p.id}')">
                    <div class="double-heart" id="dh-${p.id}">â¤</div>
                    <div class="swiper-wrapper">${urls.map(u => `<div class="swiper-slide"><img src="${u}" style="width:100%; aspect-ratio:1/1; object-fit:cover;"></div>`).join('')}</div>
                    ${urls.length > 1 ? '<div class="swiper-pagination"></div>' : ''}
                </div>
                <div style="padding:15px;">
                    <span onclick="toggleLike('${p.id}')" style="cursor:pointer; font-size:24px; color:${isLiked ? 'var(--heart)' : '#ccc'}">${isLiked ? 'â¤ï¸' : 'ğŸ¤'}</span>
                    <span style="font-size:14px; font-weight:800; margin-left:5px;">ì¢‹ì•„ìš” ${p.likes || 0}ê°œ</span>
                    <p style="margin:12px 0 0; font-size:15px; line-height:1.6; color:#444;">${p.content}</p>
                    <small style="color:#aaa; font-size:11px; margin-top:10px; display:block;">${new Date(p.created_at).toLocaleString()}</small>
                </div>
                <div class="comment-sec">
                    ${(p.comments || []).map(c => `<div style="margin-bottom:6px;"><b>${c.user_name}</b> ${c.content} ${c.user_name===myId?`<small style="opacity:0.3; margin-left:5px;" onclick="delComm('${c.id}')">ì§€ìš°ê¸°</small>`:''}</div>`).join('')}
                    <input type="text" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”..." onkeydown="if(event.key==='Enter') addComment('${p.id}', this)" style="width:100%; border:none; background:none; outline:none; margin-top:10px; font-size:13px; border-bottom:1px solid #eee; padding-bottom:5px;">
                </div>
            </div>`;
        }).join('');
        new Swiper('.swiper', { pagination: { el: '.swiper-pagination' }, observer: true, navigation: false });
    }

    async function toggleLike(pid) {
        const post = rawPosts.find(p => p.id === pid);
        let users = post.liked_users || [], likes = post.likes || 0;
        if(users.includes(myId)) { users = users.filter(u => u !== myId); likes = Math.max(0, likes - 1); }
        else { users.push(myId); likes++; }
        await client.from("posts").update({ likes, liked_users: users }).eq("id", pid);
        loadData();
    }
    async function handleDouble(pid) {
        const h = document.getElementById("dh-"+pid); h.classList.add("active"); setTimeout(()=>h.classList.remove("active"), 800);
        const post = rawPosts.find(p => p.id === pid);
        if(!post.liked_users?.includes(myId)) await toggleLike(pid);
    }
    async function addComment(pid, inp) {
        if(!inp.value.trim()) return;
        await client.from("comments").insert([{ post_id: pid, user_name: myId, content: inp.value }]);
        inp.value = ""; loadData();
    }
    async function delComm(id) { if(confirm("ëŒ“ê¸€ì„ ì‚­ì œí• ê¹Œìš”?")) { await client.from("comments").delete().eq("id", id); loadData(); } }
    function openEdit(id, content) { currentEditId = id; document.getElementById("editArea").value = content; document.getElementById("editModal").style.display = "flex"; }
    async function saveEdit() { await client.from("posts").update({ content: document.getElementById("editArea").value }).eq("id", currentEditId); location.reload(); }
    async function deletePost() { if(confirm("ê²Œì‹œë¬¼ì„ ì˜êµ¬ ì‚­ì œí• ê¹Œìš”?")) { await client.from("posts").delete().eq("id", currentEditId); location.reload(); } }
    function closeModal() { document.getElementById("editModal").style.display = "none"; document.getElementById("dateModal").style.display = "none"; }
    function filterFeed(k, b) {
        document.querySelectorAll('.btn-tab').forEach(x => x.classList.remove('active')); b.classList.add('active');
        renderPosts(k === 'all' ? rawPosts : rawPosts.filter(p => p.content.includes(k) || p.user_name === k));
    }
    function updateFileLabel(inp) { document.getElementById('fLab').innerText = `âœ… ${inp.files.length}ì¥ì˜ ì‚¬ì§„ ì„ íƒë¨`; document.getElementById('fLab').style.borderColor = "var(--main)"; }
    function runLucky() {
        const fortunes = ["ì˜¤ëŠ˜ì€ SIUUUU! ì™¸ì¹˜ê³  ì‹¶ì€ ìµœê³ ì˜ ë‚ !", "ë©¤ë²„ ì¤‘ í•œ ëª…ì´ ë‹¹ì‹ ì„ ìƒê°í•˜ê³  ìˆì–´ìš”.", "ì¸ìƒìƒ·ì„ ê±´ì§ˆ ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ìš´ì„¸!", "ë§›ìˆëŠ” ê±¸ ë¨¹ìœ¼ë©´ ë” í° í–‰ìš´ì´ ì˜¬ ê±°ì˜ˆìš”.", "ë¬´ì¡°ê±´ ì˜ í’€ë¦¬ëŠ” ë‚ ! ê³ ë¯¼í•˜ì§€ ë§ˆì„¸ìš”."];
        const seed = myId + new Date().toDateString();
        let hash = 0; for(let i=0; i<seed.length; i++) hash = ((hash << 5) - hash) + seed.charCodeAt(i);
        const idx = Math.abs(hash) % fortunes.length;
        const score = (Math.abs(hash) % 41) + 60; // 60~100ì  ì‚¬ì´
        alert(`ğŸ€ ${myId}ë‹˜ì˜ í–‰ìš´ ì§€ìˆ˜: ${score}ì \n\n"${fortunes[idx]}"`);
    }
</script>
</body>
</html>
